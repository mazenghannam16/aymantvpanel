<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… AYMAN TV - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø±</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons-Outlined" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #0d1b2a; 
            --secondary-bg: #1b263b; 
            --accent-color: #3a86ff; 
            --accent-hover: #3373dc; 
            --text-color: #e0e1dd;
            --border-color: #415a77; 
            --danger-color: #e63946; 
            --success-color: #2a9d8f;
            --edit-color: #f7b731;
        }
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        body { 
            font-family: 'Cairo', sans-serif; 
            background-color: var(--primary-bg); 
            color: var(--text-color); 
            overflow-x: hidden;
            /* Ø£ØµØ¨Ø­ Ø§Ù„Ø¬Ø³Ù… Ù‡Ùˆ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
            min-height: 100vh;
        }

        /* ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ ÙƒÙ„Ø§Ø³Ø§Øª Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ (sidebar, sidebar-nav, etc.) */

        .main-container {
            /* ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ù„ÙŠØµØ¨Ø­ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ù…Ø­ØªÙˆÙ‰ */
            width: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center; /* ØªÙˆØ³ÙŠØ· Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø£ÙÙ‚ÙŠØ§Ù‹ */
        }
        
        .content { 
            /* Ù„Ø¶Ù…Ø§Ù† ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
            width: 100%;
            max-width: 1200px;
            padding: 30px 0;
        }
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .content-header h1 { 
            font-size: 32px; 
            color: #fff;
            padding: 10px 0;
        }
        .page-content.active { display: block; }
        .card { 
            background-color: var(--secondary-bg); 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); 
            margin-bottom: 30px; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ¨Ø§Ø¹Ø¯ Ø¨ÙŠÙ† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        }
        
        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
        input, select { 
            width: 100%; 
            padding: 12px; 
            margin: 8px 0; 
            background-color: var(--primary-bg); 
            border: 1px solid var(--border-color); 
            border-radius: 8px; 
            color: var(--text-color); 
            font-family: 'Cairo', sans-serif; 
            font-size: 16px; 
        }
        button { 
            background: linear-gradient(45deg, var(--accent-color), var(--accent-hover)); 
            color: white; 
            padding: 12px 20px; 
            margin: 10px 0; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: 700; 
            width: 100%; 
            transition: transform 0.2s; 
        }
        button:hover { transform: scale(1.02); }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
        }
        th, td { 
            border: 1px solid var(--border-color); 
            padding: 12px; 
            text-align: right; 
        }
        th { background-color: var(--accent-color); }
        td img { 
            max-width: 80px; 
            border-radius: 5px; 
            height: 50px; 
            object-fit: cover; 
        }
        .actions button { 
            width: auto; 
            padding: 6px 10px; 
            font-size: 14px; 
            margin: 0 5px; 
        }
        .btn-delete { background: var(--danger-color); }
        .btn-edit { background: var(--edit-color); }
        
        /* Overlay Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; justify-content: center;
            align-items: center; z-index: 1000;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            width: 90%; max-width: 600px; padding: 30px;
            background: var(--secondary-bg); border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.7);
        }
    </style>
</head>
<body>

    <div class="main-container">
        
        <main class="content">
            <div class="content-header">
                <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… AYMAN TV - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø±</h1>
            </div>
            
            <div id="slider" class="page-content active">
                
                <div class="card">
                    <h2>Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                    <form id="addSlideForm">
                        <input type="text" id="slideTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø±ÙŠØ­Ø©" required>
                        <input type="url" id="slideImageUrl" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø´Ø±ÙŠØ­Ø© (URL)" required>
                        <input type="text" id="slideButtonText" placeholder="Ø§Ù„Ù†Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±" required>
                        
                        <label for="slideActionType" style="display:block; margin-top: 15px; margin-bottom: 5px;">Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:</label>
                        <select id="slideActionType">
                            <option value="url">Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ</option>
                            <option value="category">ÙØªØ­ Ù‚Ø³Ù… (Category)</option>
                        </select>
                        
                        <input type="url" id="slideActionUrl" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ (https://...)" required>
                        <select id="slideActionCategory" style="display:none;"></select>
                        
                        <button type="submit">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø±ÙŠØ­Ø©</button>
                    </form>
                </div>

                <div class="card">
                    <h2>Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
                    <table id="slidesTable">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                                <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                                <th>Ø®ÙŠØ§Ø±Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <div class="modal-overlay" id="editModalOverlay">
        <div class="modal-content">
            <h2>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø±ÙŠØ­Ø©</h2>
            <form id="editSlideForm">
                <input type="hidden" id="editSlideId">
                <input type="text" id="editSlideTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø±ÙŠØ­Ø©" required>
                <input type="url" id="editSlideImageUrl" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø´Ø±ÙŠØ­Ø© (URL)" required>
                <input type="text" id="editSlideButtonText" placeholder="Ø§Ù„Ù†Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±" required>
                
                <label for="editSlideActionType" style="display:block; margin-top: 15px; margin-bottom: 5px;">Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:</label>
                <select id="editSlideActionType">
                    <option value="url">Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ</option>
                    <option value="category">ÙØªØ­ Ù‚Ø³Ù… (Category)</option>
                </select>
                
                <input type="url" id="editSlideActionUrl" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ (https://...)">
                <select id="editSlideActionCategory" style="display:none;"></select>
                
                <button type="submit" style="background: var(--edit-color);">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                <button type="button" onclick="document.getElementById('editModalOverlay').style.display='none';" style="background: var(--danger-color);">Ø¥Ù„ØºØ§Ø¡</button>
            </form>
        </div>
    </div>


    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        // --- Firebase Config (Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„ÙØ¹Ù„ÙŠØ©) ---
        const firebaseConfig = {
            apiKey: "AIzaSyDLJFcW7u6RNgfqEDpX03QLYn9h_Qcytt8",
            databaseURL: "https://ayman-tv-app-default-rtdb.firebaseio.com",
            projectId: "ayman-tv-app",
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Ù…Ø³Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø³Ù„Ø§ÙŠØ¯Ø± ÙˆØ§Ù„Ù‚Ø³Ù…
        const SLIDER_PATH = 'ayman_tv/slider';
        const CATEGORIES_PATH = 'ayman_tv/categories';
        const sliderRef = database.ref(SLIDER_PATH);
        const categoriesRef = database.ref(CATEGORIES_PATH);

        // --- DOM Elements ---
        const addSlideForm = document.getElementById('addSlideForm');
        const slidesTableBody = document.getElementById('slidesTable').querySelector('tbody');
        const editModalOverlay = document.getElementById('editModalOverlay');
        const editSlideForm = document.getElementById('editSlideForm');
        
        // Ø¹Ù†Ø§ØµØ± Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        const addActionTypeSelect = document.getElementById('slideActionType');
        const addActionUrlInput = document.getElementById('slideActionUrl');
        const addActionCategorySelect = document.getElementById('slideActionCategory');
        
        // Ø¹Ù†Ø§ØµØ± Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        const editActionTypeSelect = document.getElementById('editSlideActionType');
        const editActionUrlInput = document.getElementById('editSlideActionUrl');
        const editActionCategorySelect = document.getElementById('editSlideActionCategory');


        // ======================================================
        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ¨Ø¯ÙŠÙ„ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        // ======================================================

        function setupActionToggle(typeSelect, urlInput, categorySelect) {
            const toggle = () => {
                const isUrl = typeSelect.value === 'url';
                urlInput.style.display = isUrl ? 'block' : 'none';
                categorySelect.style.display = isUrl ? 'none' : 'block';
                // URL input is required if type is 'url', Category is required otherwise
                urlInput.required = isUrl;
                categorySelect.required = !isUrl; 
            };
            typeSelect.addEventListener('change', toggle);
            toggle(); // Set initial state
        }

        // ======================================================
        // 1. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        // ======================================================

        setupActionToggle(addActionTypeSelect, addActionUrlInput, addActionCategorySelect);

        addSlideForm.addEventListener('submit', e => {
            e.preventDefault();
            const actionValue = addActionTypeSelect.value === 'url' ? addActionUrlInput.value : addActionCategorySelect.value;
            
            sliderRef.push().set({
                title: document.getElementById('slideTitle').value,
                imageUrl: document.getElementById('slideImageUrl').value,
                buttonText: document.getElementById('slideButtonText').value,
                actionType: addActionTypeSelect.value,
                actionValue: actionValue
            }).then(() => {
                alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰');
                addSlideForm.reset();
                setupActionToggle(addActionTypeSelect, addActionUrlInput, addActionCategorySelect); // Reset toggle state
            }).catch(error => {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: " + error.message);
            });
        });

        // ======================================================
        // 2. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø­Ø°Ù
        // ======================================================

        sliderRef.on('value', snap => {
            slidesTableBody.innerHTML = '';
            if (snap.exists()) {
                snap.forEach(child => {
                    const slideId = child.key;
                    const slideData = child.val();
                    const row = slidesTableBody.insertRow();
                    
                    let actionDisplay = slideData.actionType === 'url' 
                        ? `Ø±Ø§Ø¨Ø·: <a href="${slideData.actionValue}" target="_blank">${slideData.buttonText}</a>`
                        : `Ù‚Ø³Ù… ID: <strong>${slideData.actionValue}</strong> (Ø§Ù„Ø²Ø±: ${slideData.buttonText})`;

                    row.innerHTML = `
                        <td><img src="${slideData.imageUrl}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø´Ø±ÙŠØ­Ø©"></td>
                        <td>${slideData.title}</td>
                        <td>${actionDisplay}</td>
                        <td class="actions">
                            <button class="btn-edit" onclick="openEditModal('${slideId}')">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button class="btn-delete" onclick="deleteSlide('${slideId}')">Ø­Ø°Ù</button>
                        </td>
                    `;
                });
            } else {
                const row = slidesTableBody.insertRow();
                row.innerHTML = `<td colspan="4" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø±Ø§Ø¦Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹.</td>`;
            }
        });
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù (ØªØµØ¨Ø­ Ø¹Ø§Ù…Ø© Ù„ØªØ¹Ù…Ù„ Ù…Ø¹ onclick)
        window.deleteSlide = function(slideId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙŠØ­Ø©ØŸ')) {
                sliderRef.child(slideId).remove()
                .then(() => alert('ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­!'))
                .catch(error => alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: " + error.message));
            }
        }

        // ======================================================
        // 3. Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Modal)
        // ======================================================
        
        setupActionToggle(editActionTypeSelect, editActionUrlInput, editActionCategorySelect);

        // Ø¯Ø§Ù„Ø© ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        window.openEditModal = function(slideId) {
            sliderRef.child(slideId).once('value', snap => {
                const data = snap.val();
                if (data) {
                    document.getElementById('editSlideId').value = slideId;
                    document.getElementById('editSlideTitle').value = data.title;
                    document.getElementById('editSlideImageUrl').value = data.imageUrl;
                    document.getElementById('editSlideButtonText').value = data.buttonText;
                    editActionTypeSelect.value = data.actionType;
                    
                    // ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡
                    if (data.actionType === 'url') {
                        editActionUrlInput.value = data.actionValue || ''; // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‚ÙŠÙ…Ø©
                        editActionCategorySelect.value = '';
                    } else {
                        editActionCategorySelect.value = data.actionValue || '';
                        editActionUrlInput.value = '';
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø®ÙÙŠØ©/Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©
                    editActionTypeSelect.dispatchEvent(new Event('change'));

                    editModalOverlay.style.display = 'flex';
                }
            });
        };

        // Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ø±Ø³Ø§Ù„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        editSlideForm.addEventListener('submit', e => {
            e.preventDefault();
            const slideId = document.getElementById('editSlideId').value;
            const actionType = editActionTypeSelect.value;
            
            const updatedData = {
                title: document.getElementById('editSlideTitle').value,
                imageUrl: document.getElementById('editSlideImageUrl').value,
                buttonText: document.getElementById('editSlideButtonText').value,
                actionType: actionType,
                actionValue: actionType === 'url' ? editActionUrlInput.value : editActionCategorySelect.value
            };

            sliderRef.child(slideId).update(updatedData)
            .then(() => {
                alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! ğŸ‘');
                editModalOverlay.style.display = 'none'; // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
            })
            .catch(error => {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: " + error.message);
            });
        });

        // ======================================================
        // 4. ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ù„ÙƒÙ„Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠÙ†)
        // ======================================================
        
        categoriesRef.on('value', snap => {
            addActionCategorySelect.innerHTML = '';
            editActionCategorySelect.innerHTML = '';

            if (snap.exists()) {
                snap.forEach(child => {
                    const optionAdd = new Option(child.val().name, child.key);
                    const optionEdit = new Option(child.val().name, child.key);
                    
                    addActionCategorySelect.appendChild(optionAdd);
                    editActionCategorySelect.appendChild(optionEdit);
                });
                addActionCategorySelect.disabled = false;
                editActionCategorySelect.disabled = false;
            } else {
                const noOption = new Option('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… Ù…ØªØ§Ø­Ø©', '');
                addActionCategorySelect.appendChild(noOption);
                editActionCategorySelect.appendChild(noOption.cloneNode(true));
                addActionCategorySelect.disabled = true;
                editActionCategorySelect.disabled = true;
            }
        });
    </script>
</body>
</html>
